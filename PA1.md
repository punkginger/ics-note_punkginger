# PA1

## 导言

> 指导学生实现一个经过简化但功能完备的x86/mips32/riscv32(64)模拟器NEMU(NJU EMUlator), 最终在NEMU上运行游戏"仙剑奇侠传", 来让学生探究"程序在计算机上运行"的基本原理.

本课的目标在于

1. 实现一个功能完备的操作系统
2. 遵从某种规范——**指令集体系结构（ISA）**

ISA的概念比较抽象，wiki的定义如下

> In [computer science](https://en.wikipedia.org/wiki/Computer_science), an **instruction set architecture** (**ISA**), also called **[computer architecture](https://en.wikipedia.org/wiki/Computer_architecture),** is an [abstract model](https://en.wikipedia.org/wiki/Abstract_model) of a [computer](https://en.wikipedia.org/wiki/Computer). A device that executes instructions described by that ISA, such as a [central processing unit](https://en.wikipedia.org/wiki/Central_processing_unit) (CPU), is called an *implementation*.

可见ISA规定了计算机该实现什么功能

计组知识告诉我们，计算机实现功能的核心硬件cpu，是依靠指令工作的，一系列的指令的集合就是指令集。一个ISA中可能包含了多个指令集，且ISA描述了CPU应该支持的每条指令是做什么事的，即指令的功能。

另一个比较容易混淆的概念是**微体系结构（Micro-Architecture）**，它是由芯片制造厂商设计的，它规定了计算机的硬件该怎样实现ISA中规定的功能，微体系结构必须能够实现ISA规定的功能，同一种ISA可以有不同的计算机组成。

通过一张图表，我们可以清晰地看见计算机自顶向下从软件到硬件地架构，当然，值得注意的一点是，ISA与微体系结构都仅仅是抽象的规范

|       应用       |
| :--------------: |
| 高级语言程序代码 |
|  编译器/汇编器   |
|     操作系统     |
|       ISA        |
|    微体系结构    |
|       电路       |

## 程序是个状态机

要实现一个最简单的计算机（图灵机TRM），需要的部件有

1. 存储器，存储数据，程序和指令
2. 加法器（运算器），进行运算
3. 寄存器，暂时存储数据，io速度快，容量小
4. 计数器PC，记录指令的顺序

从此以后, 计算机就只需要做一件事情:

```c
while (1) {
  从PC指示的存储器位置取出指令;
  执行指令;
  更新PC;
}
```

这样, 我们就有了一个足够简单的计算机了. 我们只要将一段指令序列放置在存储器中, 然后让PC指向第一条指令, 计算机就会自动执行这一段指令序列, 永不停止.

既然计算机是一个数组逻辑电路, 那么我们可以把计算机划分成两部分, 一部分由所有时序逻辑部件(存储器, 计数器, 寄存器)构成, 另一部分则是剩余的组合逻辑部件(如加法器等). 这样以后, 我们就可以从状态机模型的视角来理解计算机的工作过程了: 在每个时钟周期到来的时候, 计算机根据当前时序逻辑部件的状态, 在组合逻辑部件的作用下, 计算出并转移到下一时钟周期的新状态.

程序由指令构成，将计算机看成一个状态机的话，就可以将指令看成计算机进行一次状态转移的输入激励，因为计算机依靠指令的执行改变自身状态。

```
	 指令
状态	——>	状态
```

对于一个有`N`BIT的计算机，共有`2^N` 种状态，如果指令确定，那么对于给定的输入状态，状态转移后输出的状态是唯一确定的。那么程序的执行就能以状态转移的视角来理解：

给定一个程序, 把它放到计算机的内存中, 就相当于在状态数量为`N`的状态转移图中指定了一个初始状态, 程序运行的过程就是从这个初始状态开始, 每执行完一条指令, 就会进行一次确定的状态转移. 也就是说, 程序也可以看成一个状态机! 这个状态机是上文提到的大状态机(状态数量为`N`)的子集.

## NEMU rtfsc
